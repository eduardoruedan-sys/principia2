<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Principia Digitalis</title>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

<style>
body{
    background:white;
    font-family:"Times New Roman", serif;
    text-align:center;
    margin:0;
}

.symbol{
    font-size:36px;
    margin-top:15px;
}

h1{
    margin:5px;
}

.subtitle{
    font-style:italic;
    margin-bottom:15px;
}

button{
    margin:8px;
    padding:8px 14px;
    cursor:pointer;
}

table{
    margin:auto;
    margin-top:20px;
    border-collapse:collapse;
}

th, td{
    border:1px solid black;
    padding:6px 10px;
}
</style>
</head>

<body>

<div class="symbol">Α &nbsp;&nbsp; Ω</div>
<h1>Principia Digitalis</h1>
<div class="subtitle">Eduardus — Adeptus in Lingua Universi</div>

<div id="graph" style="height:550px;"></div>

<button onclick="toggleAbs()">Activar / Desactivar Valor Absoluto</button>
<button onclick="toggleAsymptotes()">Activar / Desactivar Asíntotas</button>
<button onclick="toggleMusic()">Modo Urbano</button>

<table>
<tr><th>x</th><th>f(x)</th><th>g(x)</th></tr>
<tr><td>-2</td><td id="f1"></td><td id="g1"></td></tr>
<tr><td>-1</td><td id="f2"></td><td id="g2"></td></tr>
<tr><td>0</td><td id="f3"></td><td id="g3"></td></tr>
<tr><td>1</td><td id="f4"></td><td id="g4"></td></tr>
<tr><td>3.5</td><td id="f5"></td><td id="g5"></td></tr>
<tr><td>4</td><td id="f6"></td><td id="g6"></td></tr>
</table>

<audio id="music" loop>
<source src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_5c07e1e6f1.mp3?filename=urban-groove-110bpm-11018.mp3" type="audio/mp3">
</audio>

<script>

let absMode = true;
let asymptotesOn = true;

function f(x){
    return (x+1)/(x-2);
}

function gRaw(x){
    return (x-1)/(x-3);
}

function g(x){
    if(absMode){
        return Math.abs(gRaw(x));
    }else{
        return gRaw(x);
    }
}

function generateGraph(){

    let xVals=[], yF=[], yG=[];

    for(let i=-6;i<6;i+=0.05){
        if(i!==2 && i!==3){
            xVals.push(i);
            yF.push(f(i));
            yG.push(g(i));
        }
    }

    let traceF={
        x:xVals,
        y:yF,
        mode:'lines',
        line:{color:'blue'},
        name:'f(x)'
    };

    let traceG={
        x:xVals,
        y:yG,
        mode:'lines',
        line:{color:'red'},
        name:'g(x)'
    };

    let traces=[traceF, traceG];

    if(asymptotesOn){
        traces.push({
            x:[2,2],
            y:[-6,6],
            mode:'lines',
            line:{dash:'dot',color:'gray'},
            name:'x=2'
        });

        traces.push({
            x:[-6,6],
            y:[1,1],
            mode:'lines',
            line:{dash:'dot',color:'gray'},
            name:'y=1'
        });

        traces.push({
            x:[3,3],
            y:[-6,6],
            mode:'lines',
            line:{dash:'dot',color:'black'},
            name:'x=3'
        });
    }

    Plotly.newPlot('graph',traces,{
        xaxis:{range:[-6,6]},
        yaxis:{range:[-6,6]}
    });
}

function updateTable(){
    let values=[-2,-1,0,1,3.5,4];
    for(let i=0;i<values.length;i++){
        let xv=values[i];
        document.getElementById("f"+(i+1)).innerHTML=f(xv).toFixed(2);
        document.getElementById("g"+(i+1)).innerHTML=g(xv).toFixed(2);
    }
}

function toggleAbs(){
    absMode=!absMode;
    generateGraph();
    updateTable();
}

function toggleAsymptotes(){
    asymptotesOn=!asymptotesOn;
    generateGraph();
}

function toggleMusic(){
    let music=document.getElementById("music");
    if(music.paused){
        music.play();
    }else{
        music.pause();
    }
}

generateGraph();
updateTable();

</script>

</body>
</html>